24-sep-2017
\d+ retenc;
                               Tabla «public.retenc»
   Columna    |         Tipo         | Modificadores | Almacenamiento | Descripción 
--------------+----------------------+---------------+----------------+--------------
 id           | integer              | not null      | plain          | 
 vendor_id    | integer              |               | plain          | 
 tipoid_id    | character varying(2) |               | extended       | 
 idprov       | character varying    |               | extended       | 
 tipodoc_id   | integer              |               | plain          | 
 estab        | character varying(3) |               | extended       | 
 ptoemi       | character varying(3) |               | extended       | 
 sec          | character varying(9) |               | extended       | 
 ordnumber    | text                 |               | extended       | 
 transdate    | date                 |               | plain          | 
 estabret     | character varying(3) |               | extended       | 
 ptoemiret    | character varying(3) |               | extended       | 
 secret       | character varying(9) |               | extended       | 
 ordnumberret | text                 |               | extended       | 
 transdateret | date                 |               | plain          | 
 tiporet_id   | integer              |               | plain          | 
 porcret      | integer              |               | plain          | 
 base0        | double precision     |               | plain          | 
 based0       | double precision     |               | plain          | 
 baseni       | double precision     |               | plain          | 
 valret       | numeric(6,2)         |               | main           | 
 chart_id     | integer              |               | plain          | 
Tiene OIDs: sí


21-sep-2017

--- ANTES
prueba=# select trans_id, chart_id, amount, transdate, source, memo from acc_trans where trans_id = 128081;
 trans_id | chart_id | amount | transdate  |      source       |                            memo
----------+----------+--------+------------+-------------------+------------------------------------------------------------
   128081 |    11195 |  -5.27 | 2016-08-17 |                   | Compras de remarches  Para Trabajos Taller AQ1 17 Agost/16
   128081 |    10864 |  -0.73 | 2016-08-17 |                   |
   128081 |    10916 |      6 | 2016-08-17 |                   |
   128081 |    10916 |  -0.05 | 2016-08-17 |                   |
   128081 |    19198 |   0.05 | 2016-08-17 | 004-002-000003501 | Compras de Materiae spara  Trabajos AQ1
   128081 |    10916 |  -0.22 | 2016-08-17 |                   |
   128081 |    19199 |   0.22 | 2016-08-17 | 004-002-000003501 | Compras de Materiae spara  Trabajos AQ1
   128081 |    10916 |  -5.73 | 2016-08-22 |                   |
   128081 |    98611 |   5.73 | 2016-08-22 | 000314            | Reembolso de Caja Chica AQ1
(9 filas)

--- DESPUES
UPDATE 2
prueba=# select trans_id, chart_id, amount, transdate, source, memo from acc_trans where trans_id = 128081;
 trans_id | chart_id | amount | transdate  |       source       |                            memo
----------+----------+--------+------------+--------------------+------------------------------------------------------------
   128081 |    19199 |   0.22 | 2016-08-17 | 004-002-000003501* | Compras de Materiae spara  Trabajos AQ1
   128081 |    19198 |   0.05 | 2016-08-17 | 004-002-000003501* | Compras de Materiae spara  Trabajos AQ1
   128081 |    11195 |  -5.27 | 2016-08-17 |                    | Compras de remarches  Para Trabajos Taller AQ1 17 Agost/16
   128081 |    10864 |  -0.73 | 2016-08-17 |                    |
   128081 |    10916 |      6 | 2016-08-17 |                    |
   128081 |    10916 |  -0.05 | 2016-08-17 |                    |
   128081 |    10916 |  -0.22 | 2016-08-17 |                    |
   128081 |    10916 |  -5.73 | 2016-08-22 |                    |
   128081 |    98611 |   5.73 | 2016-08-22 | 000314             | Reembolso de Caja Chica AQ1
(9 filas)



prueba=# select trans_id, chart_id, amount, transdate, source, memo from acc_trans where trans_id = 156088;
 trans_id | chart_id | amount | transdate  |      source       |                            memo                            
----------+----------+--------+------------+-------------------+------------------------------------------------------------
   156088 |    19199 |   0.34 | 2017-08-29 | 004-007-000000003 | Ft# 19209 Cons. Alimentacion Viaje a Guayaquil R. Martinez
   156088 |    10916 |  -0.34 | 2017-08-29 |                   | 
   156088 |    19198 |   0.09 | 2017-08-29 | 004-007-000000003 | Ft# 19209 Cons. Alimentacion Viaje a Guayaquil R. Martinez
   156088 |    10916 |  -0.09 | 2017-08-29 |                   | 
   156088 |    10916 |   10.5 | 2017-08-29 |                   | 
   156088 |    10864 |  -1.13 | 2017-08-29 |                   | 
   156088 |    11199 |  -9.37 | 2017-08-29 |                   | Ft# 19209 Cons. Alimentacion Viaje a Guayaquil R. Martinez
(7 filas)

   id   | vendor_id | tipoid_id |    idprov     | tipodoc_id | estab | ptoemi |  sec  | ordnumber  | transdate  | estabret | ptoemiret | secret |             ordnumberret              | transdateret | tiporet_id | porcret | base0 | based0 | baseni | valret | chart_id 
--------+-----------+-----------+---------------+------------+-------+--------+-------+------------+------------+----------+-----------+--------+---------------------------------------+--------------+------------+---------+-------+--------+--------+--------+----------
 156088 |    128090 | 1         | 0911185601001 |          1 | 010   | 001    | 19209 | 1120556830 | 2017-08-29 | 004      | 007       | 3      | 2908201707200400700000000309921791559 | 2017-08-29   |        312 |       1 |     0 |   9.37 |      0 |   0.09 |    19198
 156088 |    128090 | 1         | 0911185601001 |          1 | 010   | 001    | 19209 | 1120556830 | 2017-08-29 | 004      | 007       | 3      | 2908201707200400700000000309921791559 | 2017-08-29   |          1 |      30 |     0 |      0 |   1.13 |   0.34 |    19199
(2 filas)


prueba=# \d+ acc_trans;
                                                Tabla «public.acc_trans»
    Columna     |       Tipo       |             Modificadores             | Almacenamiento | Estadísticas | Descripción 
----------------+------------------+---------------------------------------+----------------+--------------+-------------
 trans_id       | integer          |                                       | plain          |              | 
 chart_id       | integer          |                                       | plain          |              | 
 amount         | double precision |                                       | plain          |              | 
 transdate      | date             | valor por omisión ('now'::text)::date | plain          |              | 
 source         | text             |                                       | extended       |              | 
 approved       | boolean          | valor por omisión true                | plain          |              | 
 fx_transaction | boolean          | valor por omisión false               | plain          |              | 
 project_id     | integer          |                                       | plain          |              | 
 memo           | text             |                                       | extended       |              | 
 id             | integer          |                                       | plain          |              | 
 cleared        | date             |                                       | plain          |              | 
 vr_id          | integer          |                                       | plain          |              | 
 cv_id          | integer          |                                       | plain          |              | 

set client_encoding ='LATIN1';
select transdate, trans_id, source, memo from acc_trans;


"select i.parts_id, i.id, i.description, i.qty, i.sellprice, ( "+
"	select rate from tax t, chart c, partstax p "+
"	where t.chart_id = c.id and "+
"	c.category = 'L' and "+
"	p.chart_id = c.id "+
"	and p.parts_id = i.parts_id "+
") as iva12  "+
"FROM invoice i WHERE i.trans_id = 91617; "+

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

2016-mar-28 21:51:18 [main] WARN  org.hibernate.util.JDBCExceptionReporter.logExceptions(77) - SQL Error: 0, SQLState: 21000
2016-mar-28 21:51:18 [main] ERROR org.hibernate.util.JDBCExceptionReporter.logExceptions(78) - ERROR: una subconsulta utilizada como expresión retornó más de un registro
org.hibernate.exception.DataException: could not execute query
	at org.hibernate.exception.SQLStateConverter.convert(SQLStateConverter.java:77)
	at org.hibernate.exception.JDBCExceptionHelper.convert(JDBCExceptionHelper.java:43)
	at org.hibernate.loader.Loader.doList(Loader.java:2223)
	at org.hibernate.loader.Loader.listIgnoreQueryCache(Loader.java:2104)
	at org.hibernate.loader.Loader.list(Loader.java:2099)
	at org.hibernate.loader.custom.CustomLoader.list(CustomLoader.java:289)
	at org.hibernate.impl.SessionImpl.listCustomQuery(SessionImpl.java:1695)
	at org.hibernate.impl.AbstractSessionImpl.list(AbstractSessionImpl.java:142)
	at org.hibernate.impl.SQLQueryImpl.list(SQLQueryImpl.java:152)
	at ec.cjpq.fe.dao.EntidadDao.getFactura(EntidadDao.java:168)
	at ec.cjpq.fe.bean.DocumentoBean.getFactura(DocumentoBean.java:60)
	at ec.cjpq.fe.util.Proceso.autorizarComprobante(Proceso.java:48)
	at ec.cjpq.fe.util.ProcesoMain.autorizarComprobante(ProcesoMain.java:51)
	at ec.cjpq.fe.util.ProcesoMain.main(ProcesoMain.java:65)
Caused by: org.postgresql.util.PSQLException: ERROR: una subconsulta utilizada como expresión retornó más de un registro
	at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2198)
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:1927)
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:255)
	at org.postgresql.jdbc2.AbstractJdbc2Statement.execute(AbstractJdbc2Statement.java:561)
	at org.postgresql.jdbc2.AbstractJdbc2Statement.executeWithFlags(AbstractJdbc2Statement.java:419)
	at org.postgresql.jdbc2.AbstractJdbc2Statement.executeQuery(AbstractJdbc2Statement.java:304)
	at org.hibernate.jdbc.AbstractBatcher.getResultSet(AbstractBatcher.java:186)
	at org.hibernate.loader.Loader.getResultSet(Loader.java:1787)
	at org.hibernate.loader.Loader.doQuery(Loader.java:674)
	at org.hibernate.loader.Loader.doQueryAndInitializeNonLazyCollections(Loader.java:236)
	at org.hibernate.loader.Loader.doList(Loader.java:2220)
	... 11 more
2016-mar-28 21:51:18 [main] WARN  ec.cjpq.fe.util.ProcesoMain.autorizarComprobante(53) - Proceso terminado...

grep -Eio '\b(cola_id)=[0-9]+\b' cjfews.log | sort -u

cola_id=18827
cola_id=18828
cola_id=18829
cola_id=18830
cola_id=18831
cola_id=18832
cola_id=18833
cola_id=18834
cola_id=18835
cola_id=18836
cola_id=18837
cola_id=18838
cola_id=18839
cola_id=18840
cola_id=18841
cola_id=18842
cola_id=18843
cola_id=18844
cola_id=18846
cola_id=18847
cola_id=18848
cola_id=18849
cola_id=18850
cola_id=18851
cola_id=18852
cola_id=18853
cola_id=18854
cola_id=18855
cola_id=18856
cola_id=18857
cola_id=18858
cola_id=18859
cola_id=18860
cola_id=18861
cola_id=18862
cola_id=18863
cola_id=18864
cola_id=18865
cola_id=18866


grep -Eio '\b(cola_id)=[0-9]+\b' *.log.2018-02* | sort -u

cola_id=18659
cola_id=18660
cola_id=18661
cola_id=18662
cola_id=18663
cola_id=18664
cola_id=18665
cola_id=18666
cola_id=18667
cola_id=18668
cola_id=18669
cola_id=18670
cola_id=18671
cola_id=18672
cola_id=18673
cola_id=18674
cola_id=18675
cola_id=18676
cola_id=18677
cola_id=18678
cola_id=18679
cola_id=18680
cola_id=18681
cola_id=18682
cola_id=18683
cola_id=18684
cola_id=18685
cola_id=18686
cola_id=18687
cola_id=18688
cola_id=18689
cola_id=18690
cola_id=18691
cola_id=18692
cola_id=18693
cola_id=18694
cola_id=18695
cola_id=18696
cola_id=18697
cola_id=18698
cola_id=18699
cola_id=18700
cola_id=18701
cola_id=18702
cola_id=18703
cola_id=18704
cola_id=18705
cola_id=18706
cola_id=18708
cola_id=18709
cola_id=18710
cola_id=18711
cola_id=18712
cola_id=18713
cola_id=18714
cola_id=18715
cola_id=18717
cola_id=18718
cola_id=18720
cola_id=18723
cola_id=18724
cola_id=18725
cola_id=18726
cola_id=18727
cola_id=18728
cola_id=18729
cola_id=18730
cola_id=18707
cola_id=18719
cola_id=18721
cola_id=18722
cola_id=18731
cola_id=18732
cola_id=18733
cola_id=18734
cola_id=18735
cola_id=18736
cola_id=18737
cola_id=18738
cola_id=18739
cola_id=18740
cola_id=18741
cola_id=18742
cola_id=18743
cola_id=18744
cola_id=18745
cola_id=18746
cola_id=18747
cola_id=18748
cola_id=18749
cola_id=18750
cola_id=18751
cola_id=18752
cola_id=18753
cola_id=18754
cola_id=18755
cola_id=18756
cola_id=18757
cola_id=18758
cola_id=18759
cola_id=18760
cola_id=18761
cola_id=18762
cola_id=18763
cola_id=18764
cola_id=18765
cola_id=18766
cola_id=18767
cola_id=18768
cola_id=18769
cola_id=18770
cola_id=18771
cola_id=18772
cola_id=18773
cola_id=18774
cola_id=18775
cola_id=18777
cola_id=18778
cola_id=18779
cola_id=18780
cola_id=18781
cola_id=18782
cola_id=18783
cola_id=18784
cola_id=18785
cola_id=18786
cola_id=18787
cola_id=18788
cola_id=18789
cola_id=18790
cola_id=18791
cola_id=18792
cola_id=18793
cola_id=18794
cola_id=18795
cola_id=18797
cola_id=18798
cola_id=18799
cola_id=18800
cola_id=18801
cola_id=18802
cola_id=18803
cola_id=18806
cola_id=18809
cola_id=18810
cola_id=18811
cola_id=18812
cola_id=18813
cola_id=18814
cola_id=18815
cola_id=18816
cola_id=18817
cola_id=18818
cola_id=18819
cola_id=18820
cola_id=18821
cola_id=18822
cola_id=18823
cola_id=18824
cola_id=18825
cola_id=18826
cola_id=18550
cola_id=18551
cola_id=18552
cola_id=18553
cola_id=18554
cola_id=18555
cola_id=18556
cola_id=18557
cola_id=18558
cola_id=18559
cola_id=18560
cola_id=18561
cola_id=18562
cola_id=18563
cola_id=18564
cola_id=18565
cola_id=18509
cola_id=18568
cola_id=18569
cola_id=18570
cola_id=18571
cola_id=18572
cola_id=18573
cola_id=18574
cola_id=18575
cola_id=18576
cola_id=18578
cola_id=18579
cola_id=18580
cola_id=18581
cola_id=18582
cola_id=18583
cola_id=18584
cola_id=18585
cola_id=18586
cola_id=18587
cola_id=18588
cola_id=18589
cola_id=18590
cola_id=18591
cola_id=18592
cola_id=18593
cola_id=18594
cola_id=18595
cola_id=18596
cola_id=18597
cola_id=18598
cola_id=18599
cola_id=18600
cola_id=18601
cola_id=18602
cola_id=18603
cola_id=18604
cola_id=18605
cola_id=18606
cola_id=18607
cola_id=18608
cola_id=18609
cola_id=18610
cola_id=18611
cola_id=18612
cola_id=18613
cola_id=18614
cola_id=18615
cola_id=18616
cola_id=18617
cola_id=18618
cola_id=18619
cola_id=18620
cola_id=18621
cola_id=18622
cola_id=18623
cola_id=18624
cola_id=18625
cola_id=18627
cola_id=18628
cola_id=18630
cola_id=18631
cola_id=18632
cola_id=18633
cola_id=18634
cola_id=18635
cola_id=18636
cola_id=18637
cola_id=18638
cola_id=18639
cola_id=18640
cola_id=18641
cola_id=18642
cola_id=18643
cola_id=18644
cola_id=18645
cola_id=18646
cola_id=18647

************************************

18509
18550
18551
18552
18553
18554
18555
18556
18557
18558
18559
18560
18561
18562
18563
18564
18565
18568
18569
18570
18571
18572
18573
18574
18575
18576
18578
18579
18580
18581
18582
18583
18584
18585
18586
18587
18588
18589
18590
18591
18592
18593
18594
18595
18596
18597
18598
18599
18600
18601
18602
18603
18604
18605
18606
18607
18608
18609
18610
18611
18612
18613
18614
18615
18616
18617
18618
18619
18620
18621
18622
18623
18624
18625
18627
18628
18630
18631
18632
18633
18634
18635
18636
18637
18638
18639
18640
18641
18642
18643
18644
18645
18646
18647
18648
18649
18650
18651
18652
18653
18654
18655
18656
18657
18658
18659
18660
18661
18662
18663
18664
18665
18666
18667
18668
18669
18670
18671
18672
18673
18674
18675
18676
18677
18678
18679
18680
18681
18682
18683
18684
18685
18686
18687
18688
18689
18690
18691
18692
18693
18694
18695
18696
18697
18698
18699
18700
18701
18702
18703
18704
18705
18706
18707
18708
18709
18710
18711
18712
18713
18714
18715
18717
18718
18719
18720
18721
18722
18723
18724
18725
18726
18727
18728
18729
18730
18731
18732
18733
18734
18735
18736
18737
18738
18739
18740
18741
18742
18743
18744
18745
18746
18747
18748
18749
18750
18751
18752
18753
18754
18755
18756
18757
18758
18759
18760
18761
18762
18763
18764
18765
18766
18767
18768
18769
18770
18771
18772
18773
18774
18775
18777
18778
18779
18780
18781
18782
18783
18784
18785
18786
18787
18788
18789
18790
18791
18792
18793
18794
18795
18797
18798
18799
18800
18801
18802
18803
18806
18809
18810
18811
18812
18813
18814
18815
18816
18817
18818
18819
18820
18821
18822
18823
18824
18825
18826
18827
18828
18829
18830
18831
18832
18833
18834
18835
18836
18837
18838
18839
18840
18841
18842
18843
18844
18846
18847
18848
18849
18850
18851
18852
18853
18854
18855
18856
18857
18858
18859
18860
18861
18862
18863
18864
18865
18866

